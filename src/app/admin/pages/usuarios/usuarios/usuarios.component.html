<div class="container">

  <div class="card">
    <p-table
     #dt2
     [value]="users()!"
     [loading]="loading()"
     [showLoader]="false"
     dataKey="id"
     [rows]="10"
     [rowsPerPageOptions]="[10, 25, 50]"
     [paginator]="true"
     [globalFilterFields]="['first_name', 'last_name', 'username']"
     [tableStyle]="{ 'min-width': '50rem' }"
 >
     <ng-template #caption>
         <div class="flex">
             <p-iconfield iconPosition="left" class="ml-auto">
                 <p-inputicon>
                     <i class="pi pi-search"></i>
                 </p-inputicon>
                 <input
                     pInputText
                     type="text"
                     (input)="applyFilter($event)"
                     placeholder="Buscar usuario"
                 />
             </p-iconfield>
         </div>
     </ng-template>

     <ng-template #header>
         <tr>
             <th style="width:28%">Nombre</th>
             <th style="width:28%">Usuario</th>
             <th style="width:28%">Avatar</th>
             <th style="width:15%">Acciones</th>
         </tr>
     </ng-template>
       <ng-template #loadingbody let-columns="columns">
         @for (item of [1,2,3,4,5]; track $index) {
              <tr>
                <td><p-skeleton /></td>
                <td><p-skeleton /></td>
                <td><p-skeleton /></td>
                <td><p-skeleton /></td>
              </tr>
            }
       </ng-template>
       <ng-template #body let-user>
          <tr>
              <td>
                  {{ (user.first_name ?? '') + ' ' + (user.last_name ?? '')  }}
              </td>
              <td>
                  <div class="flex items-center gap-2">
                      <span>{{ user.username }}</span>
                  </div>
              </td>
              <td>
                  <div class="flex items-center gap-2">
                    @if (user.avatar && user.avatar !== null) {
                      <img alt="user-image" [src]="urlImage + user.avatar" width="32" style="vertical-align: middle" />
                    }
                  </div>
              </td>
              <td>
                <div class="flex items-center gap-2">
                  <p-button size="small" icon="pi pi-user-edit" pTooltip="Editar usuario" tooltipPosition="top" [rounded]="true" severity="info" (onClick)="openUserModal(user)" />
                  <p-button size="small" icon="pi pi-user-minus" pTooltip="Eliminar usuario" tooltipPosition="top" [rounded]="true" severity="danger" />
                </div>
              </td>
          </tr>
       </ng-template>
       <ng-template #emptymessage>
           <tr>
               <td colspan="5">No se encontraron usuarios.</td>
           </tr>
       </ng-template>
 </p-table>
 </div>

</div>

<p-dialog [visible]="editarUsuarioDialog()" [modal]="true" [closable]="false" [showHeader]="false">
  @if (userSelected()) {
    <agregar-editar-usuario [user]="userSelected()" (closeModal)="modalEmit($event)" />
  }
</p-dialog>


<p-toast />


