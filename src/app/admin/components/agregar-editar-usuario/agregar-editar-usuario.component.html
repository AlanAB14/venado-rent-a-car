<div class="min-w-72">
  @if (loading()) {
    <p-progress-spinner ariaLabel="loading" />
  }@else {
    <div class="flex flex-col">
      <div class="text-lg font-bold block mb-4">Datos de Usuario</div>
        <form [formGroup]="userForm" class="flex flex-col items-center gap-4 mb-4">
          <p-float-label variant="in" class="w-full">
            <label for="nombre">Nombre</label>
            <input class="w-full" pInputText formControlName="first_name" id="nombre" autocomplete="off" />
          </p-float-label>
          <p-float-label variant="in" class="w-full">
            <label for="apellido">Apellido</label>
            <input class="w-full" pInputText formControlName="last_name" id="apellido" autocomplete="off" />
          </p-float-label>
          <p-float-label variant="in" class="w-full">
            <label for="username">Username</label>
            <input class="w-full" pInputText formControlName="username" id="username" autocomplete="off" />
          </p-float-label>
          @if (!user()) {
            <p-float-label variant="in" class="w-full">
              <label for="password">Contraseña</label>
              <input class="w-full" type="password" pInputText formControlName="password" id="password" autocomplete="off" />
            </p-float-label>
          }@else {
            <p-button label="Cambiar Contraseña" (onClick)="this.changePasswordDialog.set(true);" severity="info" styleClass="!w-full" class="w-full"/>
          }
          <p-float-label variant="in" class="w-full">
            <p-select [options]="roles()" formControlName="role_id" inputId="rol" class="w-full" optionLabel="type" optionValue="id"/>
            <label for="rol">Rol</label>
          </p-float-label>
          <p-float-label variant="in" class="w-full">
            <label for="email">Email</label>
            <input class="w-full" pInputText formControlName="email" id="email" autocomplete="off" />
          </p-float-label>
            <div class="flex flex-col gap-1 w-full">
              <label class="font-bold cursor-pointer" (click)="fileInput.click()">Avatar</label>
              <img class="flex cursor-pointer self-center w-24 h-auto" [src]="avatarPreview()" alt="" (click)="fileInput.click()">
              <input
                #fileInput
                type="file"
                accept="image/*"
                style="display: none"
                (change)="onAvatarChange($event)"
              />
            </div>
        </form>
      <div class="flex justify-end gap-2">
        <p-button label="Cancel" severity="secondary" (click)="close({openModal: false})" />
        <p-button label="Guardar" [disabled]="userForm.invalid || userForm.pristine" (click)="updateUserDialog()" />
      </div>
    </div>
  }
</div>

<p-dialog [visible]="changePasswordDialog()" [closable]="false" [showHeader]="false">
  <div class="flex flex-col gap-4">
    <form [formGroup]="passwordForm">
      <p-float-label variant="in" class="w-full">
        <label for="password">Nueva Contraseña</label>
        <input class="w-full" type="password" pInputText formControlName="password" id="password" autocomplete="off" />
      </p-float-label>
    </form>
    <div class="flex justify-end gap-2">
      <p-button label="Cancel" severity="secondary" (click)="changePasswordDialog.set(false)" />
      <p-button label="Guardar" [disabled]="passwordForm.invalid" (click)="changePassword()" />
    </div>
  </div>
</p-dialog>

<p-toast />
